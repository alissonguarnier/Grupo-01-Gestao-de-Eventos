{% extends 'relatorios/base_pdf.html' %}

{% block content %}
<style>
  /* Estilo do container de cada grupo */
  .grupo-container {
    margin-bottom: 30px;
    page-break-inside: avoid;
    /* Tenta não quebrar o grupo no meio da página */
  }

  .grupo-header {
    background-color: #0056b3;
    color: white;
    padding: 8px 10px;
    font-size: 14px;
    font-weight: bold;
    border-radius: 4px 4px 0 0;
    margin-bottom: 0;
  }

  /* Tabela de Membros */
  table {
    width: 100%;
    border-collapse: collapse;
    border: 1px solid #ddd;
    font-size: 11px;
  }

  th {
    background-color: #f2f2f2;
    color: #333;
    text-align: left;
    padding: 6px;
    border-bottom: 1px solid #ccc;
  }

  td {
    padding: 6px;
    border-bottom: 1px solid #eee;
    vertical-align: top;
    /* Alinha o texto no topo para listas longas */
    color: #444;
  }

  /* Listas internas (eventos/atividades) */
  .lista-interna {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .lista-interna li {
    margin-bottom: 2px;
  }

  .badge-tipo {
    font-size: 9px;
    padding: 1px 4px;
    border-radius: 3px;
    background-color: #eee;
    color: #555;
    margin-right: 3px;
  }

  .txt-azul {
    color: #0056b3;
    font-weight: bold;
  }
</style>

<h1 style="text-align: center; margin-bottom: 20px;">{{ titulo }}</h1>
<div style="text-align: right; font-size: 10px; color: #666; margin-bottom: 20px;">
  Gerado em: {% now "d/m/Y H:i" %}
</div>

{% for grupo in grupos %}
<div class="grupo-container">
  <div class="grupo-header">
    Grupo: {{ grupo.name }}
    <span style="font-size: 11px; font-weight: normal; float: right;">
      (ID: {{ grupo.id }} | Total Membros: {{ grupo.user_set.count }})
    </span>
  </div>

  <table>
    <thead>
      <tr>
        <th width="35%">Membro</th>
        <th width="25%">Contato</th>
        <th width="40%">Envolvimento (Inscrições e Responsabilidades)</th>
      </tr>
    </thead>
    <tbody>
      {% for user in grupo.user_set.all %}
      <tr>
        <td>
          <span class="txt-azul">#{{ user.id }}</span>
          <strong>{{ user.first_name }} {{ user.last_name }}</strong><br>
          <span style="font-size: 10px; color: #777;">Usuário do sistema</span>
        </td>

        <td>
          {{ user.email }}
        </td>

        <td>
          {% if user.atividades_responsavel.exists %}
          <div style="margin-bottom: 8px;">
            <strong style="color: #d63384;">Responsável por:</strong>
            <ul class="lista-interna">
              {% for atv in user.atividades_responsavel.all %}
              <li>{{ atv.titulo }} <small>({{ atv.horario_inicio|date:"H:i" }})</small></li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
          {% if user.usereventos_set.exists %}
          <div>
            <strong style="color: #28a745;">Inscrito em:</strong>
            <ul class="lista-interna">
              {% for inscricao in user.usereventos_set.all %}
              <li>
                {{ inscricao.evento.nome }}
                <small>({{ inscricao.get_status_display }})</small>
              </li>
              {% endfor %}
            </ul>
          </div>
          {% endif %}
          {% if not user.atividades_responsavel.exists and not user.usereventos_set.exists %}
          <span style="color: #ccc; font-style: italic;">Sem atividades recentes.</span>
          {% endif %}
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="3" style="text-align: center; padding: 15px; color: #999;">
          Este grupo não possui usuários vinculados.
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% if not forloop.last %}<div style="margin-bottom: 40px;"></div>{% endif %}

{% endfor %}

{% endblock %}